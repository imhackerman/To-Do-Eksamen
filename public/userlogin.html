
<link rel= "stylesheet" href="style.css">

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Courgette&display=swap"
  rel="stylesheet"
/>
<header class= "midtstill">
<h1> To Do App Login</h1>



<input id="inputUsername" type="text" placeholder="Brukernavn" /> 
<input id="inputPassword" type="text" placeholder="Passord" />


<button id="btnLogin">Login</button>
<button id="btnLogin">Opprett bruker</button>
<h3 id="txtResult">Result</h3>
</header> 

<!------------- JavaScript --------------->
<script>
  let inputUsername = document.getElementById("inputUsername");
  let inputPassword = document.getElementById("inputPassword");
  let btnLogin = document.getElementById("btnLogin");
  let txtResult = document.getElementById("txtResult");

  btnLogin.addEventListener("click", async function (evt) {
    let url = "/users/login";
    let userURL = '/users'
    let credString = createCredentialString(inputUsername.value, inputPassword.value);
    localStorage.setItem('username', inputUsername.value)
    

    let cfg = {
      method: "POST",
      headers: {'authorization': credString}
    };

    try {
      let response = await fetch(url, cfg);
      let data = await response.json();

      if (response.status != 200) {
        throw data.error;
      }

      let userresponse = await fetch(userURL);
      let userdata = await userresponse.json();

      for(let value of userdata){
        if(value.username == inputUsername.value){
          console.log(value.id)
          localStorage.setItem('id', value.id)
        }
      }
    

      
     
      txtResult.innerHTML = data.msg;
      localStorage.setItem("token", data.token);
      //window.location.href = '/tasklist.html'


    } catch (error) {
      console.log(error);
      txtResult.innerHTML = "Something went wrong";
    }
  });

  function createCredentialString(username, password) {
    let combinedStr = username + ":" + password;
    let b64Str = btoa(combinedStr);
    return "basic" + b64Str;
  }

  async function getUserId(username){

 
  } 

 
</script>
