
<link rel= "stylesheet" href="style.css">

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Courgette&display=swap"
  rel="stylesheet"
/>
<header class= "midtstill">
<h1> To Do App Login</h1>
<br>



<input id="inputUsername" type="text" placeholder="Brukernavn" /> 
<input id="inputPassword" type="text" placeholder="Passord" />
<input type="checkbox" onload="hiddenPassword()" >Gjem passord
<hr><br>

<button id="btnLogin">Login</button>
<button id="btnLogin">Opprett bruker</button>
<h3 id="txtResult"></h3>
</header> 




<!------------- JavaScript --------------->
<script>

window.onload=function(){
  let x = document.getElementById("inputPassword");
  if (x.type === "password") {
    x.type = "text";
  } else {
    x.type = "password";
  }

};

function showPassword() {
  let x = document.getElementById("inputPassword");
  if (x.type === "text") {
    x.type = "password";
  } else {
    x.type = "text";
  }
}


  let inputUsername = document.getElementById("inputUsername");
  let inputPassword = document.getElementById("inputPassword");
  let btnLogin = document.getElementById("btnLogin");
  let txtResult = document.getElementById("txtResult");

  btnLogin.addEventListener("click", async function (evt) {
    let url = "/users/login";
    let credString = createCredentialString(inputUsername.value, inputPassword.value);

    let cfg = {
      method: "POST",
      headers: {'authorization': credString}
    };

    try {
      let response = await fetch(url, cfg);
      let data = await response.json();

      if (response.status != 200) {
        throw data.error;
      }

      txtResult.innerHTML = data.msg;
      localStorage.setItem("token", data.token);
      console.log(data)
      window.location.href = '/tasklist.html'


    } catch (error) {
      console.log(error);
      txtResult.innerHTML = "Feil brukernavn eller passord!";
    }
  });

  function createCredentialString(username, password) {
    let combinedStr = username + ":" + password;
    let b64Str = btoa(combinedStr);
    return "basic" + b64Str;
  }
</script>
