<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="tasklist.html"></script>
<style>
* {
  box-sizing: border-box;
}

/* Create two equal columns that floats next to each other */
.column {
  float: left;
  width: 50%;
  padding: 10px;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
/* Style the buttons */
.btn {
  border: none;
  outline: none;
  padding: 12px 16px;
  background-color: #f1f1f1;
  cursor: pointer;
}

.btn:hover {
  background-color: #ddd;
}

.btn.active {
  background-color: #666;
  color: white;
}
</style>
</head>
<body>

<h2>List View or Grid View</h2>

<p>Click on a button to choose list view or grid view.</p>

<div id="btnContainer">
  <button class="btn" onclick="listView()"><i class="fa fa-bars"></i> List</button> 
  <button class="btn active" onclick="gridView()"><i class="fa fa-th-large"></i> Grid</button>
</div>
<br>

<div class="row">
  <div class="column" style="background-color:#aaa;">
    
    
    
  </div>
  <div class="column" style="background-color:#bbb;">
    <script>

        let createListBtn = document.getElementById('createList');
    
        createListBtn.addEventListener('click', async function(evt){
    
        })
    
    
        let container = document.getElementById('container');
    
    
        async function listTaskList(){
            
            let url = "/lists"
            let taskurl = "/task"
    
            try {
                let listresponse = await fetch(url);
                let listdata = await listresponse.json();
    
                if (listresponse.status != 200) {
                    throw listdata.error;
                }
    
                let taskresponse = await fetch(taskurl)
                let taskdata = await taskresponse.json();
    
                if(taskresponse.status != 200){
                    throw taskresponse.error;
                }
            
                container.innerHTML = "";
    
                console.log(listdata)
    
            for (let list of listdata) { 
            
    
                let html = `<p>${list.title}</p>`;
                let div = document.createElement("div");
                div.innerHTML = html;
                container.appendChild(div);
    
                let deleteListButton = document.createElement('button');
                deleteListButton.innerHTML = 'Slett liste';
                deleteListButton.addEventListener('click', function(evt){
                    deleteList(value.listid)
                })
    
                div.appendChild(deleteListButton)
    
                let createNewTask = document.createElement('button');
                createNewTask.innerHTML = 'Nytt gjøremål'
                createNewTask.addEventListener('click', async function(evt){
    
                    localStorage.setItem('List', list.id)
                    window.location.href = '/taskcreate.html'
                })
    
                div.appendChild(createNewTask)
    
    
                for(let task of taskdata){
    
                    if(list.id == task.listid){
                        let taskhtml = '<p>' + task.task + '</p>'
    
                        let taskdiv = document.createElement('div');
                        taskdiv.innerHTML = taskhtml;
                        container.appendChild(taskdiv)
    
    
                        let deleteTaskButton = document.createElement('button')
                        deleteTaskButton.innerHTML = 'Delete'
                        deleteTaskButton.addEventListener('click', function(evt){
                            deleteTask(task.id);
                        })
    
                        taskdiv.appendChild(deleteTaskButton)
                    }
                }
            }
        }
        catch(error) {
            console.log(error);
            }
        }
    
            async function deleteTask(taskId) {
    
            let url ="/task";
    
            let updata= {
                id: taskId
            }
    
            console.log(updata)
    
            let cfg = {
                method: "DELETE",
                headers: {"content-type":"application/json"},
                body: JSON.stringify(updata)
            }
    
            try {
                let response = await fetch(url, cfg);
                let data = await response.json();
    
                if (response.status != 200) {
                    throw data.error;
                }
                
                listTaskList(); // refreshes the lists
            }catch(error){
                console.log(error)
            }
        }
    
            async function deleteList(listId){
    
            let url = '/tasklist'
    
            let updata = {
                listid: listId
            }
    
            console.log(updata);
    
            let cfg = {
                method: "DELETE",
                headers: {"content-type":"application/json"},
                body: JSON.stringify(updata)
            }
    
            try {
                let response = await fetch(url, cfg);
                let data = await response.json();
    
                if (response.status != 200) {
                    throw data.error;
                }
                
                listTaskList(); // refreshes the lists
            }catch(error){
                console.log(error)
            }
        }
        
     
    
    
        listTaskList()
    
     
    
    
    </script>
    <h2>testerarea</h2>
    <p>Some tasdasdext..</p>
    <div container.appendChild(taskdiv)></div>
  </div>
</div>

<div class="row">
  <div class="column" style="background-color:#ccc;">
    <h2>Column 3</h2>
    <p>Some text..</p>
  </div>
  <div class="column" style="background-color:#ddd;">
    <h2>Column 4</h2>
    <p>Some text..</p>
  </div>
</div>

<script>
// Get the elements with class="column"
var elements = document.getElementsByClassName("column");

// Declare a loop variable
var i;

// List View
function listView() {
  for (i = 0; i < elements.length; i++) {
    elements[i].style.width = "100%";
  }
}

// Grid View
function gridView() {
  for (i = 0; i < elements.length; i++) {
    elements[i].style.width = "50%";
  }
}

/* Optional: Add active class to the current button (highlight it) */
var container = document.getElementById("btnContainer");
var btns = container.getElementsByClassName("btn");
for (var i = 0; i < btns.length; i++) {
  btns[i].addEventListener("click", function() {
    var current = document.getElementsByClassName("active");
    current[0].className = current[0].className.replace(" active", "");
    this.className += " active";
  });
}


let createListBtn = document.getElementById('createList');

createListBtn.addEventListener('click', async function(evt){

})


let container = document.getElementById('container');


async function listTaskList(){
    
    let url = "/lists"
    let taskurl = "/task"

    try {
        let listresponse = await fetch(url);
        let listdata = await listresponse.json();

        if (listresponse.status != 200) {
            throw listdata.error;
        }

        let taskresponse = await fetch(taskurl)
        let taskdata = await taskresponse.json();

        if(taskresponse.status != 200){
            throw taskresponse.error;
        }
    
        container.innerHTML = "";

        console.log(listdata)

    for (let list of listdata) { 
    

        let html = `<p>${list.title}</p>`;
        let div = document.createElement("div");
        div.innerHTML = html;
        container.appendChild(div);

        let deleteListButton = document.createElement('button');
        deleteListButton.innerHTML = 'Slett liste';
        deleteListButton.addEventListener('click', function(evt){
            deleteList(value.listid)
        })

        div.appendChild(deleteListButton)

        let createNewTask = document.createElement('button');
        createNewTask.innerHTML = 'Nytt gjøremål'
        createNewTask.addEventListener('click', async function(evt){

            localStorage.setItem('List', list.id)
            window.location.href = '/taskcreate.html'
        })

        div.appendChild(createNewTask)


        for(let task of taskdata){

            if(list.id == task.listid){
                let taskhtml = '<p>' + task.task + '</p>'

                let taskdiv = document.createElement('div');
                taskdiv.innerHTML = taskhtml;
                container.appendChild(taskdiv)


                let deleteTaskButton = document.createElement('button')
                deleteTaskButton.innerHTML = 'Delete'
                deleteTaskButton.addEventListener('click', function(evt){
                    deleteTask(task.id);
                })

                taskdiv.appendChild(deleteTaskButton)
            }
        }
    }
}
catch(error) {
    console.log(error);
    }
}

    async function deleteTask(taskId) {

    let url ="/task";

    let updata= {
        id: taskId
    }

    console.log(updata)

    let cfg = {
        method: "DELETE",
        headers: {"content-type":"application/json"},
        body: JSON.stringify(updata)
    }

    try {
        let response = await fetch(url, cfg);
        let data = await response.json();

        if (response.status != 200) {
            throw data.error;
        }
        
        listTaskList(); // refreshes the lists
    }catch(error){
        console.log(error)
    }
}

    async function deleteList(listId){

    let url = '/tasklist'

    let updata = {
        listid: listId
    }

    console.log(updata);

    let cfg = {
        method: "DELETE",
        headers: {"content-type":"application/json"},
        body: JSON.stringify(updata)
    }

    try {
        let response = await fetch(url, cfg);
        let data = await response.json();

        if (response.status != 200) {
            throw data.error;
        }
        
        listTaskList(); // refreshes the lists
    }catch(error){
        console.log(error)
    }
}




listTaskList()





</script>

</body>
</html>
